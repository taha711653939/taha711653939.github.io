<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø±Ø¯Ø´Ø© Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ø¹ Gemini</title>
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØµÙØ­Ø© */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .chat-container {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }
        
        /* Ø±Ø£Ø³ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        .chat-header {
            background: linear-gradient(90deg, #4285f4 0%, #34a853 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-header h1 {
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
        }
        
        .logo {
            background: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4285f4;
            font-weight: bold;
            font-size: 20px;
        }
        
        .api-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #34a853;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        .chat-box {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: #f8f9fa;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .message {
            max-width: 80%;
            padding: 18px 22px;
            border-radius: 22px;
            line-height: 1.6;
            word-wrap: break-word;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            animation: fadeIn 0.4s ease;
            position: relative;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #4285f4, #34a853);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            align-self: flex-start;
            background: white;
            color: #1a1a1a;
            border: 1px solid #e1e5e9;
            border-bottom-left-radius: 5px;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .message-sender {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .message-time {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .message-content {
            font-size: 16px;
            line-height: 1.7;
        }
        
        .bot-icon {
            width: 24px;
            height: 24px;
            background: #4285f4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
        
        .user-icon {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4285f4;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-area {
            padding: 25px;
            border-top: 1px solid #eef2f7;
            background: white;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        #user-input {
            flex: 1;
            padding: 18px 25px;
            border: 2px solid #e1e5e9;
            border-radius: 18px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
            background: #f8f9fa;
            resize: none;
            min-height: 60px;
            max-height: 150px;
            line-height: 1.5;
        }
        
        #user-input:focus {
            border-color: #4285f4;
            background: white;
            box-shadow: 0 0 0 4px rgba(66, 133, 244, 0.1);
        }
        
        #send-btn {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            border: none;
            border-radius: 18px;
            padding: 0 40px;
            height: 60px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
        }
        
        #send-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(66, 133, 244, 0.3);
        }
        
        #send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .typing-indicator {
            align-self: flex-start;
            background: white;
            padding: 20px 25px;
            border-radius: 22px;
            border: 1px solid #e1e5e9;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            display: none;
        }
        
        .typing-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .typing-dots {
            display: flex;
            gap: 6px;
        }
        
        .typing-dots span {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4285f4;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1.1); opacity: 1; }
        }
        
        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API */
        .api-settings {
            background: #f8f9fa;
            padding: 25px 30px;
            border-top: 1px solid #eef2f7;
            border-bottom: 1px solid #eef2f7;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .api-input-group {
            margin-bottom: 20px;
        }
        
        .api-input-group label {
            display: block;
            margin-bottom: 12px;
            color: #1a1a1a;
            font-weight: 600;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .api-input-group label i {
            color: #4285f4;
            font-size: 18px;
        }
        
        #api-key-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            background: white;
            font-family: monospace;
            letter-spacing: 0.5px;
        }
        
        #api-key-input:focus {
            border-color: #4285f4;
            box-shadow: 0 0 0 4px rgba(66, 133, 244, 0.1);
        }
        
        .api-info {
            background: #e8f0fe;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            border-right: 4px solid #4285f4;
        }
        
        .api-info h4 {
            color: #1a73e8;
            margin-bottom: 8px;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .api-info p {
            font-size: 14px;
            color: #5f6368;
            line-height: 1.6;
        }
        
        .api-info a {
            color: #1a73e8;
            text-decoration: none;
            font-weight: 500;
        }
        
        .api-info a:hover {
            text-decoration: underline;
        }
        
        /* ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-control {
            text-align: center;
            padding: 20px;
            background: white;
            border-top: 1px solid #eef2f7;
        }
        
        .toggle-settings {
            background: transparent;
            border: 2px solid #e1e5e9;
            color: #5f6368;
            padding: 12px 30px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .toggle-settings:hover {
            border-color: #4285f4;
            color: #4285f4;
            background: #f8f9fa;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù„Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .chat-container {
                height: 100vh;
                max-width: 100%;
                border-radius: 0;
            }
            
            body {
                padding: 0;
            }
            
            .message {
                max-width: 90%;
                padding: 15px 18px;
            }
            
            .input-area {
                padding: 20px;
                gap: 15px;
            }
            
            #send-btn {
                padding: 0 25px;
                height: 56px;
            }
            
            .chat-header {
                padding: 15px 20px;
            }
            
            .chat-header h1 {
                font-size: 18px;
            }
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .chat-box::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-box::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .chat-box::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        .chat-box::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…Ø­ØªÙˆÙ‰ */
        .message-content pre {
            background: #f6f8fa;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid #e1e4e8;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .message-content code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Ø±Ø£Ø³ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
        <div class="chat-header">
            <h1>
                <span class="logo">G</span>
                Ø¯Ø±Ø¯Ø´Ø© Gemini Ø§Ù„Ø°ÙƒÙŠØ©
            </h1>
            <div class="api-status">
                <span class="status-dot"></span>
                <span id="status-text">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§ØªØµØ§Ù„</span>
            </div>
        </div>
        
        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API -->
        <div class="api-settings" id="api-settings">
            <div class="api-input-group">
                <label>
                    <span>ğŸ”‘</span>
                    Ù…ÙØªØ§Ø­ Google Gemini API:
                </label>
                <input 
                    type="text" 
                    id="api-key-input" 
                    placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§ (ÙŠØ¨Ø¯Ø£ Ø¨Ù€ AIza...)"
                    value="YOUR_NEW_API_KEY_HERE"
                >
            </div>
            
            <div class="api-info">
                <h4><span>ğŸ’¡</span> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©:</h4>
                <p>
                    â€¢ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ API Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù…Ù† 
                    <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a><br>
                    â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ <strong>Gemini API</strong> ÙÙŠ Google Cloud Console<br>
                    â€¢ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¶Ù…Ù† <strong>Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</strong> Ù…ØªØ§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯<br>
                    â€¢ <strong style="color: #d93025;">ØªØ­Ø°ÙŠØ±:</strong> Ù„Ø§ ØªØ´Ø§Ø±Ùƒ Ù…ÙØªØ§Ø­Ùƒ Ù…Ø¹ Ø£ÙŠ Ø´Ø®Øµ
                </p>
            </div>
        </div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
        <div class="chat-box" id="chat-box">
            <!-- Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
            <div class="message bot-message">
                <div class="message-header">
                    <div class="message-sender">
                        <span class="bot-icon">AI</span>
                        Ù…Ø³Ø§Ø¹Ø¯ Gemini
                    </div>
                    <div class="message-time" id="welcome-time">Ø§Ù„Ø¢Ù†</div>
                </div>
                <div class="message-content">
                    Ù…Ø±Ø­Ø¨Ø§Ù‹! ğŸ‘‹ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ù† Google Gemini.<br><br>
                    ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:
                    <ul style="margin: 10px 0 10px 20px; color: #5f6368;">
                        <li>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„ØªÙƒ Ø§Ù„Ø¹Ø§Ù…Ø©</li>
                        <li>ÙƒØªØ§Ø¨Ø© ÙˆØªØ­Ø±ÙŠØ± Ø§Ù„Ù†ØµÙˆØµ</li>
                        <li>Ø´Ø±Ø­ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„ØªÙ‚Ù†ÙŠØ©</li>
                        <li>Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¨ÙŠÙ† Ø§Ù„Ù„ØºØ§Øª</li>
                        <li>Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© ÙˆØ­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª</li>
                    </ul>
                    <strong>âš ï¸ ØªØ°ÙƒØ±:</strong> Ø§Ø³ØªØ¨Ø¯Ù„ <code>YOUR_NEW_API_KEY_HERE</code> ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø®Ø§Øµ!
                </div>
            </div>
            
            <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© -->
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-content">
                    <div class="bot-icon">AI</div>
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
        <div class="input-area">
            <textarea 
                id="user-input" 
                placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§... (Ø§Ø¶ØºØ· Shift+Enter Ù„Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŒ Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„)"
                rows="1"
                autocomplete="off"
                spellcheck="true"
            ></textarea>
            <button id="send-btn">
                <span>Ø¥Ø±Ø³Ø§Ù„</span>
                <span style="font-size: 20px;">â†—ï¸</span>
            </button>
        </div>
        
        <!-- ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div class="settings-control">
            <button class="toggle-settings" id="toggle-settings">
                <span>âš™ï¸</span>
                Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API
            </button>
        </div>
    </div>

    <!-- Ø¬Ù…ÙŠØ¹ Ø£ÙƒÙˆØ§Ø¯ JavaScript -->
    <script>
        // ========== ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ==========
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiSettings = document.getElementById('api-settings');
        const toggleSettingsBtn = document.getElementById('toggle_settings');
        const statusText = document.getElementById('status-text');
        const welcomeTime = document.getElementById('welcome-time');

        // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ==========
        window.addEventListener('load', () => {
            // ØªØ¹ÙŠÙŠÙ† ÙˆÙ‚Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ©
            welcomeTime.textContent = getCurrentTime();
            
            // ØªØ­Ù…ÙŠÙ„ Ù…ÙØªØ§Ø­ API Ø§Ù„Ù…Ø­ÙÙˆØ¸
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                apiKeyInput.value = savedKey;
                updateApiStatus();
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            apiSettings.style.display = 'none';
            
            // Ø¶Ø¨Ø· Ø§Ø±ØªÙØ§Ø¹ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            autoResizeTextarea();
            
            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            userInput.focus();
        });

        // ========== Ø¥Ø¯Ø§Ø±Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API ==========
        toggleSettingsBtn.addEventListener('click', () => {
            const isVisible = apiSettings.style.display === 'block';
            apiSettings.style.display = isVisible ? 'none' : 'block';
            toggleSettingsBtn.innerHTML = isVisible ? 
                '<span>âš™ï¸</span> Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API' : 
                '<span>âš™ï¸</span> Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API';
            
            if (!isVisible) {
                apiKeyInput.focus();
            }
        });

        // Ø­ÙØ¸ Ù…ÙØªØ§Ø­ API Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
        apiKeyInput.addEventListener('input', () => {
            const key = apiKeyInput.value.trim();
            localStorage.setItem('gemini_api_key', key);
            updateApiStatus();
        });

        // ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ==========
        // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„Ø²Ø±
        sendBtn.addEventListener('click', sendMessage);

        // Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù€ Enter (Ù…Ø¹ Ø¯Ø¹Ù… Shift+Enter Ù„Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯)
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù†Øµ
        userInput.addEventListener('input', autoResizeTextarea);

        // ========== Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ ==========
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            addMessage(message, 'user');
            userInput.value = '';
            autoResizeTextarea();
            
            // ØªØ¹Ø·ÙŠÙ„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            disableInput(true);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            showTyping(true);
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ API
            const apiKey = apiKeyInput.value.trim();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…ÙØªØ§Ø­
            if (!apiKey || !apiKey.startsWith('AIza')) {
                showError('Ù…ÙØªØ§Ø­ API ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ Google Gemini API ØµØ­ÙŠØ­.');
                return;
            }
            
            try {
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
                statusText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Gemini...';
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Google Gemini API
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ ÙŠØªØ­Ø¯Ø« Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. 
                                    Ù‚Ø¯Ù… Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ÙÙŠØ¯Ø© ÙˆÙˆØ§Ø¶Ø­Ø©. 
                                    Ø¥Ø°Ø§ Ø³Ø£Ù„Ùƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù† Ø´ÙŠØ¡ Ù„Ø§ ØªØ¹Ø±ÙÙ‡ØŒ Ù‚Ù„ Ø¨ØµØ±Ø§Ø­Ø© Ø£Ù†Ùƒ Ù„Ø§ ØªØ¹Ø±Ù.
                                    Ø§Ø³ØªØ®Ø¯Ù… ØªÙ†Ø³ÙŠÙ‚ Markdown Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯.
                                    Ø§Ù„Ø³Ø¤Ø§Ù„: ${message}`
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                topK: 40,
                                topP: 0.95,
                                maxOutputTokens: 2048
                            },
                            safetySettings: [
                                {
                                    category: "HARM_CATEGORY_HARASSMENT",
                                    threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                },
                                {
                                    category: "HARM_CATEGORY_HATE_SPEECH",
                                    threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                },
                                {
                                    category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                    threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                },
                                {
                                    category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                    threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                }
                            ]
                        })
                    }
                );
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `Ø®Ø·Ø£ ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.candidates || data.candidates.length === 0) {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ø±Ø¯ Ù…Ù† Gemini. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø­Ø¸ÙˆØ±Ø§Ù‹.');
                }
                
                const botReply = data.candidates[0].content.parts[0].text;
                
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
                showTyping(false);
                addMessage(botReply, 'bot');
                statusText.textContent = 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©';
                
            } catch (error) {
                showTyping(false);
                handleApiError(error);
            } finally {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                disableInput(false);
                userInput.focus();
            }
        }

        // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const messageHeader = document.createElement('div');
            messageHeader.className = 'message-header';
            
            const senderDiv = document.createElement('div');
            senderDiv.className = 'message-sender';
            
            const icon = document.createElement('div');
            icon.className = sender === 'user' ? 'user-icon' : 'bot-icon';
            icon.textContent = sender === 'user' ? 'Ø£Ù†Øª' : 'AI';
            
            const senderName = document.createElement('span');
            senderName.textContent = sender === 'user' ? 'Ø£Ù†Øª' : 'Ù…Ø³Ø§Ø¹Ø¯ Gemini';
            
            senderDiv.appendChild(icon);
            senderDiv.appendChild(senderName);
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = getCurrentTime();
            
            messageHeader.appendChild(senderDiv);
            messageHeader.appendChild(timeDiv);
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Markdown Ø§Ù„Ø¨Ø³ÙŠØ·Ø©
            let formattedText = text;
            formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formattedText = formattedText.replace(/\*(.*?)\*/g, '<em>$1</em>');
            formattedText = formattedText.replace(/`([^`]+)`/g, '<code>$1</code>');
            formattedText = formattedText.replace(/```([\s\S]*?)```/g, '<pre>$1</pre>');
            
            messageContent.innerHTML = formattedText;
            
            messageDiv.appendChild(messageHeader);
            messageDiv.appendChild(messageContent);
            
            // Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‚Ø¨Ù„ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            chatBox.insertBefore(messageDiv, typingIndicator);
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© API
        function updateApiStatus() {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                statusText.textContent = 'âšª Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ API';
            } else if (!apiKey.startsWith('AIza')) {
                statusText.textContent = 'ğŸ”´ Ù…ÙØªØ§Ø­ ØºÙŠØ± ØµØ§Ù„Ø­';
            } else {
                statusText.textContent = 'ğŸŸ¢ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§ØªØµØ§Ù„';
            }
        }

        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
        function showTyping(show) {
            typingIndicator.style.display = show ? 'block' : 'none';
            if (show) {
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        function disableInput(disable) {
            userInput.disabled = disable;
            sendBtn.disabled = disable;
            sendBtn.innerHTML = disable ? 
                '<span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...</span>' : 
                '<span>Ø¥Ø±Ø³Ø§Ù„</span><span style="font-size: 20px;">â†—ï¸</span>';
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ø±ØªÙØ§Ø¹ Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ
        function autoResizeTextarea() {
            userInput.style.height = 'auto';
            userInput.style.height = (userInput.scrollHeight) + 'px';
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ API
        function handleApiError(error) {
            console.error('Gemini API Error:', error);
            
            let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
            
            if (error.message.includes('400')) {
                errorMessage = 'Ø·Ù„Ø¨ ØºÙŠØ± ØµØ§Ù„Ø­. ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© Ø§Ù„Ù…ÙØªØ§Ø­ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
            } else if (error.message.includes('403')) {
                errorMessage = 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Gemini API ÙˆØªÙ‚ÙŠÙŠØ¯Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­.';
            } else if (error.message.includes('429')) {
                errorMessage = 'ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„.';
            } else if (error.message.includes('500') || error.message.includes('503')) {
                errorMessage = 'Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø®Ø§Ø¯Ù… Google. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.';
            } else if (error.message.includes('QUOTA_EXCEEDED')) {
                errorMessage = 'ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­ØµØ© Ø§Ù„Ù…Ø®ØµØµØ©. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ ÙÙŠ Google Cloud Console.';
            } else if (error.message.includes('API key')) {
                errorMessage = 'Ù…ÙØªØ§Ø­ API ØºÙŠØ± ØµØ§Ù„Ø­. ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨ØªÙ‡ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.';
            } else if (error.message.includes('Ù…Ø­Ø¸ÙˆØ±') || error.message.includes('blocked')) {
                errorMessage = 'ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©.';
            }
            
            addMessage(`âš ï¸ ${errorMessage}`, 'bot');
            statusText.textContent = 'ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
        }

        // Ø¹Ø±Ø¶ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function showError(message) {
            showTyping(false);
            addMessage(`âŒ ${message}`, 'bot');
            statusText.textContent = 'ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
            disableInput(false);
        }
    </script>
</body>
    </html>
